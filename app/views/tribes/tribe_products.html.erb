<table class="tribe_header_box">
    <td id="tribe_name_menu">
        <div class="tribe_name_box"><%= @tribe.tribe_name %></div>
    </td>
    <td class="amount_saved_by_members">
      <div id="saved_amount">$xxxx.xx</div><br />
      saved by members
    </td>
    <td class="add_friends_to_tribe">
      <div class="add_friends_box_field">
        xx members<br />
        
        <script>
              $(function() {
                $( "#autocomplete-input" ).autocomplete({
                  source: function( request, response ) {
                  $.ajax({
                    url: "https://graph.facebook.com/me/friends?access_token=<%= current_user.token %>&callback=?",
                    dataType: "jsonp",
                    data: {
                    width: 250,
                    height: 400,
                    max: 8,
                    cacheLength: 10,
                    minChars: 1,
                      featureClass: "P",
                      style: "full",
                      maxRows: "5",
                      name_startsWith: request.term
                    },
                    success: function( data ) {
                      res = $.map( data.data, function( item ) {
                        if (item.name.toLowerCase().indexOf(request.term.toLowerCase()) >= 0){
                          return {
                            label: item.name,
                            value: item.id
                          }
                        }
                      });
                      response(res);
                    }
                  });
                },
                minLength: 0,
                select: function( event, ui ) {
                  // log( ui.item ?
                  // "Selected: " + ui.item.label :
                  // "Nothing selected, input was " + this.value);
                },
                open: function() {
                  $( this ).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
                },
                close: function() {
                  $( this ).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
                }
                });
             $("#autocomplete-input").data("autocomplete")._renderItem =  function( ul, item ) {
              var image_url = "http://graph.facebook.com/" + item.value +"/picture";
              return $( "<li style='height:40px;'>" ).append($("<img style='float:left;height:35px;'>").attr('src',image_url))
              .append( $( "<a>" ).text( item.label ) )
              .appendTo( '#friendslist' );
           }

              });
        </script>
        

          <ul>
            <li>
             <input id="autocomplete-input" />
            </li>
          </ul>
          <!--<div id="friendslist"></div> -->
      </div>
      
    </td>
    <td class="tribe_created_by_users">
        <section id="tribe_create">
          <table>
            <td>
              <%= link_to (image_tag(FbGraph::User.new(@tribe.created_by).fetch.picture, :class => 'created_user_image' )) %>
            </td>
            <td>          
              <div class="tribe_created_text">Tribe created by:</div>
              <div class="tribe_created_user_name"> <%= FbGraph::User.new(@tribe.created_by).fetch.name %></div>
              <div class="created_user_ratings">*****</div>
           </td>
         </table>
        </section>
    </td>
</table>

<div class="request_product_box">  
    <table>
      <td>
        <%= link_to image_tag("/assets/plus_icon.png", :class => 'plus_icon') %>
      </td>      
      <td>
      <div class="request_input_box_border">        
        <%= text_field_tag 'search', nil, :class => 'request_input_box', :placeholder => 'Serach product' %>
      </div>
      </td>                  
      <%= form_tag("/products", :method => "post") do %>
      <td>
       <%= image_submit_tag("/assets/request_product_icon.png", :class => 'request_product_icon') %>        
      </td>
      <td>      
        <%= hidden_field_tag :tribe, @tribe._id %>
        <%= text_field_tag 'product_name', nil, :class => 'request_input_box', :placeholder => 'Request new product' %>      
      </td>
      <% end %>
    </table>       
</div><br />

<% @tribe.products.each do |product| %>
  <div class="products_main_container">
      <div class="product_offers_time_box">
        <table>
          <td>
            <div>
              <span onclick="toggle_visibility('hiding');">Hide</span>
              <script type="text/javascript">
                  function toggle_visibility(id) {
                     var e = document.getElementById(id);
                     if(e.style.display == 'block')
                        e.style.display = 'none';
                     else
                        e.style.display = 'block';
                  }
              </script>
            </div>
          </td>
          <td>
            <div class="product_offers_small_box">
              <table style="margin-top:7px;">
                  <td style="width:200px;">
                    <span class="product_offers_box_text">Product</span><br/>
                    <span class="product_offers_box_text2"><%= product.product_name %></span>
                  </td>
                  <td style="width:80px; text-align:center;">
                    <span class="product_offers_box_text">Offers</span><br />
                    <span  class="product_offers_box_text3"><%= product.offers.count %></span>
                  </td>
              </table>
            </div>
          </td>
          <td>
            <div class="products_want_this_box">
              <div id="wants_box"> <% @ad = no_of_wants(params[:id], product.product_name, current_user.uid )  %>
              <%= @ad.size %><br/> Wants this
              <%= link_to image_submit_tag("/assets/iwantthis.png", :class => 'want_this_box'), tribe_products_tribes_path(:id => params[:id], :product_name => product.product_name) %>
            </div> 
            </div>
          </td>
          <td>            
            <div class="products_contdown_time_box"> 
              
               <div id="time_left_to_open"></div>
               <div id="time">OPEN</div>
               <script>
                 var newYear = new Date(); 
                 newYear = new Date(newYear.getFullYear() + 1, 1 - 1, 1);                 
                 $('#time_left_to_open').countdown({until: newYear, format: 'dHMS'}); 
               </script>
            </div>
          </td>
        </table>
      </div>
      <div  id="hiding">
      <div class="products_sub_container">
        <div class="products_description_box">
           <%= product.description %>
        </div>
        <div class="description_dotted_line"></div>
        <div class="products_offers_received_text">
          Offers Received
        </div>
        <div>
          <table class="data_table" cellpadding="0" cellspacing="0" border="0" style="opacity:1;">
            <thead>
              <tr>
                <th style="width:220px; border-right:1px solid #000;">company</th>
                <th style="width:250px; border-right:1px solid #000;">product</th>
                <th style="width:100px; border-right:1px solid #000;">price</th>
                <th style="width:100px; border-right:1px solid #000;">time of bid</th>
                <th style="width:200px;">min #</th>
              </tr>
            </thead>
            <tbody>
              <tr style="text-align:center;">
                <td><%= product.business_name %></td>
                <td><%= product.product_name %></td>
                <td><%= product.price %></td>
                <td>time</td>
                <% product.offers.each do |each_offer| %>
                 <td> <%= each_offer['min_no_of_buyer'] %> </td>
                <% end %>
              </tr>
            </tbody>
          </table>             
        </div>
       </div>
        <div class="comments_header">Comments</div>
        <% if product.comments.empty? %>
              <div class="No_comments_header">
                <span class="No_comments_text">No comments yet.</span>
                <span class="mylink" id="#<%= product._id %>">Leave a comment</span>
              </div>
              <div id="<%= product._id %>" class="comments_body_box" style ="display:none">
                <%= form_tag add_comment_products_path do  %>
                  <div class="field">	      
                    <%= hidden_field_tag :product_id, product._id %>
                    <%= hidden_field_tag :user_id, current_user.uid %>
                  </div>                    
                  <div class="field">
                    <%= text_field_tag :body %>
                  </div>
                  <div class="actions">
                  <%= submit_tag("Submit") %>
                  </div>
                <% end %>
              </div>        
        <% else %>
              
              <% product.comments.each do |product_comments| %>
                <div class="comments_text_box">
                  <span class="comments_user_name"><%= product_comments.user_id %></span>:
                  <%= product_comments.body %>
                </div>
              <% end %>
               <div class="mylink" id="#<%= product._id %>">Leave a comment</div>
               <div id="<%= product._id %>" class="comments_body_box" style ="display:none">
                <%= form_tag add_comment_products_path do  %>
                  <div class="field">	      
                    <%= hidden_field_tag :product_id, product._id %>
                    <%= hidden_field_tag :user_id, current_user.uid %>
                  </div>                    
                  <div class="field">
                    <%= text_field_tag :body %>
                  </div>
                  <div class="actions">
                  <%= submit_tag("Submit") %>
                  </div>
                <% end %>
              </div>     
        <% end %>     
        <br />        
      </div>
      </div>
    <br />
<% end %>

<!--    
<script type="text/javascript">
  $('#i_want_this').click(function() {    
    // force cross-site scripting (as of jQuery 1.5)
    jQuery.support.cors = true;
    console.log($(this).val());
    $.get('/tribes/i_want_this',
    {tribe_id:'<%#= params[:id] %>', product: 'aaa'},
      function(data) {

      }, 'script'
    );
  });
</script>    
-->

<script>
 $(function(){
   $('.mylink').click(function(event){      
      $(event.target.id).toggle();      
   });
});
</script>
